generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Gender {
  MALE
  FEMALE
}

enum Relationship {
  FATHER
  MOTHER
}

enum AttendanceStatus {
  PRESENT
  ABSENT
}

enum TeacherRole {
  ADMIN
  TEACHER
}

enum TeacherApprovalStatus {
  PENDING
  APPROVED
  REJECTED
}

model Teacher {
  id             String                @id @default(cuid())
  email          String                @unique
  name           String?
  phone          String?
  birthDate      DateTime?
  grade          String?
  role           TeacherRole           @default(TEACHER)
  approvalStatus TeacherApprovalStatus @default(PENDING)
  isActive       Boolean               @default(true)
  createdAt      DateTime              @default(now())
  updatedAt      DateTime              @updatedAt
}

model Student {
  id                String              @id @default(cuid())
  name              String
  gender            Gender
  birthDate         DateTime
  address           String
  phone             String?
  currentTalent     Int                 @default(0)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  parentContact     ParentContact?
  attendances       Attendance[]
  talentTransactions TalentTransaction[]
}

model ParentContact {
  id           String   @id @default(cuid())
  studentId    String   @unique
  name         String
  relationship Relationship
  phone        String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  student      Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
}

model Attendance {
  id             String           @id @default(cuid())
  studentId      String
  attendanceDate DateTime
  status         AttendanceStatus
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt

  student        Student          @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([studentId, attendanceDate])
  @@index([attendanceDate])
}

model TalentTransaction {
  id            String   @id @default(cuid())
  studentId     String
  transactedAt  DateTime @default(now())
  amount        Int
  createdAt     DateTime @default(now())

  student       Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@index([studentId, transactedAt])
}
